# Makefile for DBX C++ SQLite Comparison Benchmark

CXX = g++
CXXFLAGS = -std=c++17 -Wall -Wextra -O3 -I../include -I../../c/include
LDFLAGS = -L../../../target/release

# Platform-specific settings
ifeq ($(OS),Windows_NT)
    LDLIBS = -ldbx_ffi -lsqlite3 -lws2_32 -luserenv -lbcrypt
    EXE = .exe
else
    UNAME_S := $(shell uname -s)
    ifeq ($(UNAME_S),Darwin)
        LDLIBS = -ldbx_ffi -lsqlite3 -framework Security
    else
        LDLIBS = -ldbx_ffi -lsqlite3 -lpthread -ldl
    endif
    EXE =
endif

TARGET = benchmark_vs_sqlite$(EXE)

all: $(TARGET)

$(TARGET): benchmark_vs_sqlite.cpp
	$(CXX) $(CXXFLAGS) -o $@ $< $(LDFLAGS) $(LDLIBS)

run: $(TARGET)
	./$(TARGET)

clean:
	rm -f $(TARGET) sqlite_bench.db

.PHONY: all run clean
